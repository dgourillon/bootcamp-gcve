




VEN_NAME=global-ven
PROJECT_ID=$(gcloud config get-value project)
PROJECT_NUMBER=$(gcloud projects list --filter="$PROJECT_ID" --format="value(PROJECT_NUMBER)")
GCVE_NETWORK_NAME=gcve-network

PC1_NAME=pc-1
PC1_LOCATION=us-west2
PC1_ADMIN_RANGE="10.170.0.0/20"
PC2_NAME=pc-2
PC2_LOCATION=us-west2
PC2_ADMIN_RANGE="10.170.16.0/20"

gcloud services peered-dns-domains create gcve-peering \
    --network=$GCVE_NETWORK_NAME \
    --dns-suffix="gve.goog."

PC1_DOMAIN=$(gcloud vmware private-clouds describe $PC1_NAME --location=$PC1_LOCATION-a --format="value(vcenter.fqdn)" | cut -d '.' -f 2-4)
PC1_DNS=$(gcloud vmware private-clouds describe $PC1_NAME --location=$PC1_LOCATION-a --format="value(networkConfig.dnsServerIp)")

gcloud dns --project=$PROJECT_ID managed-zones create $(echo $PC1_DOMAIN | tr '.' '-') \
--description="" \
--dns-name="$PC1_DOMAIN" \
--visibility="private" \
--networks="https://www.googleapis.com/compute/v1/projects/$PROJECT_ID/global/networks/$GCVE_NETWORK_NAME" \
--forwarding-targets="$PC1_DNS"

PC2_DOMAIN=$(gcloud vmware private-clouds describe $PC2_NAME --location=$PC2_LOCATION-a --format="value(vcenter.fqdn)" | cut -d '.' -f 2-4)
PC2_DNS=$(gcloud vmware private-clouds describe $PC2_NAME --location=$PC2_LOCATION-a --format="value(networkConfig.dnsServerIp)")

gcloud dns --project=$PROJECT_ID managed-zones create $(echo $PC2_DOMAIN | tr '.' '-') \
--description="" \
--dns-name="$PC2_DOMAIN" \
--visibility="private" \
--networks="https://www.googleapis.com/compute/v1/projects/$PROJECT_ID/global/networks/$GCVE_NETWORK_NAME" \
--forwarding-targets="$PC2_DNS"
