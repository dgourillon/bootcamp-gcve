




. ./00-variables.sh


gcloud services peered-dns-domains create gcve-peering \
    --network=$GCVE_NETWORK_NAME \
    --dns-suffix="gve.goog."

PC1_DOMAIN=$(gcloud vmware private-clouds describe $PC1_NAME --location=$PC1_LOCATION-a --format="value(vcenter.fqdn)" | cut -d '.' -f 2-4)
PC1_DNS=$(gcloud vmware private-clouds describe $PC1_NAME --location=$PC1_LOCATION-a --format="value(networkConfig.dnsServerIp)")

gcloud dns --project=$PROJECT_ID managed-zones create $(echo $PC1_DOMAIN | tr '.' '-') \
--description="" \
--dns-name="$PC1_DOMAIN" \
--visibility="private" \
--networks="https://www.googleapis.com/compute/v1/projects/$PROJECT_ID/global/networks/$GCVE_NETWORK_NAME" \
--forwarding-targets="$PC1_DNS"

PC2_DOMAIN=$(gcloud vmware private-clouds describe $PC2_NAME --location=$PC2_LOCATION-a --format="value(vcenter.fqdn)" | cut -d '.' -f 2-4)
PC2_DNS=$(gcloud vmware private-clouds describe $PC2_NAME --location=$PC2_LOCATION-a --format="value(networkConfig.dnsServerIp)")

gcloud dns --project=$PROJECT_ID managed-zones create $(echo $PC2_DOMAIN | tr '.' '-') \
--description="" \
--dns-name="$PC2_DOMAIN" \
--visibility="private" \
--networks="https://www.googleapis.com/compute/v1/projects/$PROJECT_ID/global/networks/$GCVE_NETWORK_NAME" \
--forwarding-targets="$PC2_DNS"
